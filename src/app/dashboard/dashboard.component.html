<div class="dashboard-container">
  <!-- Top Metrics Section -->
  <div class="metrics d-flex flex-wrap gap-3">
    <div class="card flex-grow-1 min-width-300" *ngFor="let metric of metrics">
      <div class="card-heading text-nowrap">{{ metric.title }}</div>
      <div class="card-middle-content d-flex align-items-center">
        <span class="text-nowrap">{{ metric.value }}</span>
        <div
          *ngIf="metric.increment"
          [ngClass]="{
            'increment-positive': metric.increment.startsWith('+'),
            'increment-negative': metric.increment.startsWith('-')
          }"
          class="increment ms-2"
        >
          <span class="icon-container">
            <i
              class="fa-solid"
              [ngClass]="{
                'fa-arrow-trend-up': metric.increment.startsWith('+'),
                'fa-arrow-trend-down': metric.increment.startsWith('-')
              }"
            ></i>
          </span>
          <span class="increment-text text-nowrap">
            {{ metric.increment }}
          </span>
        </div>
      </div>
      <div
        class="card-bottom-content d-flex flex-column flex-sm-row justify-content-between align-items-center gap-2"
      >
        <p
          class="duration mb-0 text-nowrap text-truncate"
          style="max-width: 150px"
          [title]="metric.subtext"
        >
          {{ metric.subtext }}
        </p>
        <button class="button-class text-nowrap mt-1">See details</button>
      </div>
    </div>
  </div>

  <!-- Patient Visits Chart -->
  <div class="chart-container">
    <h4>Patient Visit</h4>
    <div>
      <highcharts-chart
        *ngIf="isBrowser"
        [Highcharts]="Highcharts"
        [options]="visitChartOptions"
        style="width: 100%; height: 300px; display: block"
      >
      </highcharts-chart>
    </div>
  </div>

  <!-- Appointments -->
  <!-- Appointments -->
  <div class="appointments">
    <div class="d-flex justify-content-between">
      <h4>Upcoming Appointments</h4>
      <!-- Filters Section -->
      <div class="filters mb-4">
        <input
          type="text"
          placeholder="Search by name or symptoms..."
          class="filter-input"
          [(ngModel)]="searchQuery"
        />
      </div>
    </div>
    <!-- Grid Section -->
    <div class="table-responsive">
      <table class="table table-hover">
        <!-- Header Row -->
        <thead>
          <tr class="table-header">
            <th scope="col" class="fw-bold">Patient Name</th>
            <th scope="col" class="fw-bold">Visit Type</th>
            <th scope="col" class="fw-bold">Symptoms</th>
            <th scope="col" class="fw-bold">Status</th>
          </tr>
        </thead>
        <!-- Filtered Rows -->
        <tbody>
          <tr
            *ngFor="let appointment of filteredAppointments()"
            class="align-middle"
          >
            <td>
              <div class="d-flex align-items-center">
                <img
                  src="../../assets/default-avatar.jpg"
                  class="rounded-circle me-2"
                  width="32"
                  height="32"
                />
                <span>{{ appointment.name }}</span>
              </div>
            </td>
            <td>
              <i class="bi bi-clipboard-pulse me-2"></i>
              {{ appointment.visitType }}
            </td>
            <td>
              <span class="text-mute">{{ appointment.symptoms }}</span>
            </td>
            <td>
              <span
                class="badge rounded-pill px-3 py-2"
                [ngClass]="{
                  'bg-success': appointment.status === 'Confirmed',
                  'bg-warning text-dark': appointment.status === 'Pending',
                  'bg-danger': appointment.status === 'Cancelled'
                }"
              >
                {{ appointment.status }}
              </span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Income Card Section -->
  <div class="chart-container card">
    <div class="card-body">
      <!-- Card Heading -->
      <div class="card-title text-center mb-3">
        <h4>Income</h4>
      </div>

      <!-- Card Middle Content -->
      <div class="d-flex justify-content-between align-items-center mb-4">
        <!-- Filter Dropdown -->
        <div class="income-dropdown d-flex align-items-center">
          <label for="income-filter" class="me-2 fw-bold">Filter by:</label>
          <select
            id="income-filter"
            [(ngModel)]="incomeFilter"
            class="form-select form-select-sm w-auto"
          >
            <option value="7days">Last 7 Days</option>
            <option value="monthly">Monthly</option>
          </select>
        </div>

        <!-- Total Income -->
        <div class="total-income text-success fw-bold">
          <strong>Total Income:</strong> {{ totalIncome | currency }}
        </div>
      </div>

      <!-- Chart Section -->
      <div
        class="chart-wrapper"
        style="position: relative; height: 300px; width: 100%"
      >
        <highcharts-chart
          *ngIf="isBrowser"
          [Highcharts]="Highcharts"
          [options]="incomeChartOptions"
          style="display: block; width: 100%; height: 100%"
        >
        </highcharts-chart>
      </div>
    </div>
  </div>
</div>
