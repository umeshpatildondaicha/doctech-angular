<div class="profile-container">

  <!-- Profile Content -->
  <div class="profile-content">
    <div class="profile-card">
      <!-- Profile Header -->
      <div class="profile-header">
        <div class="header-background"></div>
        <div class="avatar-section">
          <div class="avatar-container">
            <div class="avatar">
              <app-icon [fontIcon]="'person'" [size]="48" [color]="'white'" class="avatar-icon"></app-icon>
            </div>
            <div class="avatar-badge" *ngIf="isEditing">
              <app-icon [fontIcon]="'camera_alt'" [size]="16" [color]="'white'"></app-icon>
            </div>
          </div>
          <div class="profile-info">
            <h2 class="profile-name">{{ profileForm.get('firstName')?.value }} {{ profileForm.get('lastName')?.value }}</h2>
            <p class="profile-role">{{ profileForm.get('specialization')?.value }}</p>
            <div class="profile-stats">
              <div class="stat-item">
                <app-icon [fontIcon]="'schedule'" [size]="16" [color]="'rgba(255, 255, 255, 0.9)'"></app-icon>
                <span>{{ profileForm.get('experience')?.value }} years experience</span>
              </div>
              <div class="stat-item">
                <app-icon [fontIcon]="'verified'" [size]="16" [color]="'rgba(255, 255, 255, 0.9)'"></app-icon>
                <span>License: {{ profileForm.get('licenseNumber')?.value }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Profile Completion & Quick Stats -->
      <div class="profile-overview">
        <div class="completion-section">
          <div class="completion-header">
            <h3>Profile Completion</h3>
            <span class="completion-percentage">{{ profileCompletion }}%</span>
          </div>
          <mat-progress-bar 
            [value]="profileCompletion" 
            [color]="getProfileCompletionColor()"
            class="completion-bar">
          </mat-progress-bar>
          <p class="completion-text">Complete your profile to improve visibility and patient trust</p>
        </div>
        
        <div class="quick-stats">
          <div class="stat-card" *ngFor="let stat of quickStats">
            <div class="stat-icon" [class]="'stat-' + stat.color">
              <app-icon [fontIcon]="stat.icon" [size]="24" [color]="'white'"></app-icon>
            </div>
            <div class="stat-content">
              <div class="stat-value">{{ stat.value }}</div>
              <div class="stat-label">{{ stat.label }}</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Tabbed Navigation -->
      <div class="tab-navigation">
        <mat-tab-group 
          [selectedIndex]="selectedTab" 
          (selectedIndexChange)="onTabChange($event)"
          class="profile-tabs"
          mat-align-tabs="start">
          
          <!-- Personal Information Tab -->
          <mat-tab>
            <ng-template mat-tab-label>
              <div class="tab-label">
                <app-icon [fontIcon]="'person_outline'" [size]="20" [color]="'currentColor'"></app-icon>
                <span>Personal Info</span>
              </div>
            </ng-template>
            <div class="tab-content">
              <div class="tab-description">
                <h3>Personal Information</h3>
                <p>Manage your basic personal details and professional bio</p>
              </div>
              <form [formGroup]="profileForm" class="profile-form">
                <div class="form-section">
                  <div class="section-header">
                    <app-icon [fontIcon]="'person_outline'" [size]="24" [color]="'#3b82f6'"></app-icon>
                    <h3 class="section-title">Basic Information</h3>
                  </div>
                  <div class="form-grid">
                    <div class="form-row">
                      <app-input
                        label="First Name"
                        formControlName="firstName"
                        placeholder="Enter first name"
                        [required]="true"
                        [errorMessage]="getErrorMessage('firstName')"
                        [disabled]="!isEditing"
                        class="form-field">
                      </app-input>
                    </div>

                    <div class="form-row">
                      <app-input
                        label="Last Name"
                        formControlName="lastName"
                        placeholder="Enter last name"
                        [required]="true"
                        [errorMessage]="getErrorMessage('lastName')"
                        [disabled]="!isEditing"
                        class="form-field">
                      </app-input>
                    </div>

                    <div class="form-row">
                      <app-input
                        label="Email Address"
                        formControlName="email"
                        placeholder="Enter email address"
                        type="email"
                        [required]="true"
                        [errorMessage]="getErrorMessage('email')"
                        [disabled]="!isEditing"
                        class="form-field">
                      </app-input>
                    </div>

                    <div class="form-row">
                      <app-input
                        label="Phone Number"
                        formControlName="phone"
                        placeholder="Enter phone number"
                        [required]="true"
                        [errorMessage]="getErrorMessage('phone')"
                        [disabled]="!isEditing"
                        class="form-field">
                      </app-input>
                    </div>

                    <div class="form-row">
                      <div class="field-with-info">
                        <app-input
                          label="Personal Contact Number (Administrative Only)"
                          formControlName="personalPhone"
                          placeholder="Enter personal contact number"
                          [disabled]="!isEditing"
                          class="form-field">
                        </app-input>
                        <div class="info-icon-wrapper">
                          <app-icon [fontIcon]="'info'" [size]="16" [color]="'#6b7280'"></app-icon>
                          <div class="tooltip">
                            <span>This number is for administrative purposes only (app issues, technical support, etc.) and will NOT be shared with patients or the public.</span>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="form-row">
                      <app-input
                        label="Date of Birth"
                        formControlName="dateOfBirth"
                        placeholder="Select date of birth"
                        type="date"
                        [disabled]="!isEditing"
                        class="form-field">
                      </app-input>
                    </div>

                    <div class="form-row">
                      <app-selectbox
                        label="Gender"
                        formControlName="gender"
                        [options]="['Male', 'Female', 'Other']"
                        [disabled]="!isEditing"
                        class="form-field">
                      </app-selectbox>
                    </div>
                  </div>
                </div>

                <div class="form-section">
                  <div class="section-header">
                    <app-icon [fontIcon]="'home'" [size]="24" [color]="'#3b82f6'"></app-icon>
                    <h3 class="section-title">Address Information</h3>
                  </div>
                  <div class="form-grid">
                    <div class="form-row">
                      <app-input
                        label="Street Address"
                        formControlName="streetAddress"
                        placeholder="Enter street address"
                        [disabled]="!isEditing"
                        class="form-field">
                      </app-input>
                    </div>

                    <div class="form-row">
                      <app-input
                        label="City"
                        formControlName="city"
                        placeholder="Enter city"
                        [disabled]="!isEditing"
                        class="form-field">
                      </app-input>
                    </div>

                    <div class="form-row">
                      <app-input
                        label="State/Province"
                        formControlName="state"
                        placeholder="Enter state or province"
                        [disabled]="!isEditing"
                        class="form-field">
                      </app-input>
                    </div>

                    <div class="form-row">
                      <app-input
                        label="Postal Code"
                        formControlName="postalCode"
                        placeholder="Enter postal code"
                        [disabled]="!isEditing"
                        class="form-field">
                      </app-input>
                    </div>

                    <div class="form-row">
                      <app-input
                        label="Country"
                        formControlName="country"
                        placeholder="Enter country"
                        [disabled]="!isEditing"
                        class="form-field">
                      </app-input>
                    </div>
                  </div>
                </div>

                <div class="form-section">
                  <div class="section-header">
                    <app-icon [fontIcon]="'description'" [size]="24" [color]="'#3b82f6'"></app-icon>
                    <h3 class="section-title">Professional Bio</h3>
                  </div>
                  <div class="form-grid">
                    <div class="form-row full-width">
                      <app-input
                        label="Professional Bio"
                        formControlName="professionalBio"
                        placeholder="Tell us about your professional background, expertise, and approach to patient care..."
                        [multiline]="true"
                        [rows]="4"
                        [disabled]="!isEditing"
                        class="form-field">
                      </app-input>
                    </div>
                  </div>
                </div>
              </form>
            </div>
          </mat-tab>

          <!-- Professional Info Tab -->
          <mat-tab>
            <ng-template mat-tab-label>
              <div class="tab-label">
                <app-icon [fontIcon]="'medical_services'" [size]="20" [color]="'currentColor'"></app-icon>
                <span>Professional</span>
              </div>
            </ng-template>
            <div class="tab-content">
              <div class="tab-description">
                <h3>Professional Information</h3>
                <p>Manage your medical credentials, practice details, and research information</p>
              </div>
              <form [formGroup]="profileForm" class="profile-form">
                <div class="form-section">
                  <div class="section-header">
                    <app-icon [fontIcon]="'medical_services'" [size]="24" [color]="'#3b82f6'"></app-icon>
                    <h3 class="section-title">Medical Credentials</h3>
                  </div>
                  <div class="form-grid">
                    <div class="form-row">
                      <app-selectbox
                        label="Specialization"
                        formControlName="specialization"
                        [options]="specializations"
                        [required]="true"
                        [errorMessage]="getErrorMessage('specialization')"
                        [disabled]="!isEditing"
                        class="form-field">
                      </app-selectbox>
                    </div>

                    <div class="form-row">
                      <app-input
                        label="Qualifications"
                        formControlName="qualifications"
                        placeholder="e.g., MBBS, MD - Internal Medicine"
                        [required]="true"
                        [errorMessage]="getErrorMessage('qualifications')"
                        [disabled]="!isEditing"
                        class="form-field">
                      </app-input>
                    </div>

                    <div class="form-row">
                      <app-input
                        label="Years of Experience"
                        formControlName="experience"
                        placeholder="Enter years of experience"
                        type="number"
                        [required]="true"
                        [errorMessage]="getErrorMessage('experience')"
                        [disabled]="!isEditing"
                        class="form-field">
                      </app-input>
                    </div>

                    <div class="form-row">
                      <label class="form-label">License Number</label>
                      <input
                        type="text"
                        formControlName="licenseNumber"
                        placeholder="Enter license number"
                        [disabled]="!isEditing"
                        class="form-field"
                        style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                      <div *ngIf="getErrorMessage('licenseNumber')" style="color: red; font-size: 12px; margin-top: 4px;">
                        {{ getErrorMessage('licenseNumber') }}
                      </div>
                    </div>
                  </div>
                </div>

                <div class="form-section">
                  <div class="section-header">
                    <app-icon [fontIcon]="'healing'" [size]="24" [color]="'#3b82f6'"></app-icon>
                    <h3 class="section-title">Medical Practice</h3>
                  </div>
                  <div class="form-grid">
                    <div class="form-row full-width">
                      <app-input
                        label="Treatments Offered"
                        formControlName="treatmentsOffered"
                        placeholder="List treatments and services offered"
                        [multiline]="true"
                        [rows]="3"
                        [disabled]="!isEditing"
                        class="form-field">
                      </app-input>
                    </div>

                    <div class="form-row full-width">
                      <app-input
                        label="Areas of Expertise"
                        formControlName="areasOfExpertise"
                        placeholder="List your areas of expertise and specializations"
                        [multiline]="true"
                        [rows]="3"
                        [disabled]="!isEditing"
                        class="form-field">
                      </app-input>
                    </div>

                    <div class="form-row full-width">
                      <app-input
                        label="Research Interests"
                        formControlName="researchInterests"
                        placeholder="Describe your research interests and publications"
                        [multiline]="true"
                        [rows]="3"
                        [disabled]="!isEditing"
                        class="form-field">
                      </app-input>
                    </div>
                  </div>
                </div>

                <div class="form-section">
                  <div class="section-header">
                    <app-icon [fontIcon]="'groups'" [size]="24" [color]="'#3b82f6'"></app-icon>
                    <h3 class="section-title">Professional Memberships</h3>
                  </div>
                  <div class="form-grid">
                    <div class="form-row full-width">
                      <app-input
                        label="Professional Memberships"
                        formControlName="professionalMemberships"
                        placeholder="List professional memberships"
                        [multiline]="true"
                        [rows]="3"
                        [disabled]="!isEditing"
                        class="form-field">
                      </app-input>
                    </div>
                  </div>
                </div>
              </form>
            </div>
          </mat-tab>

          <!-- Work & Availability Tab -->
          <mat-tab>
            <ng-template mat-tab-label>
              <div class="tab-label">
                <app-icon [fontIcon]="'business'" [size]="20" [color]="'currentColor'"></app-icon>
                <span>Work & Availability</span>
              </div>
            </ng-template>
            <div class="tab-content">
              <div class="tab-description">
                <h3>Work & Availability</h3>
                <p>Manage your work affiliations, availability schedule, and communication preferences</p>
              </div>
              <form [formGroup]="profileForm" class="profile-form">
                <div class="form-section">
                  <div class="section-header">
                    <app-icon [fontIcon]="'business'" [size]="24" [color]="'#3b82f6'"></app-icon>
                    <h3 class="section-title">Affiliations</h3>
                  </div>
                  <div class="form-grid">
                    <div class="form-row">
                      <app-input
                        label="Affiliated Hospitals"
                        formControlName="affiliatedHospitals"
                        placeholder="Enter affiliated hospitals"
                        [disabled]="!isEditing"
                        class="form-field">
                      </app-input>
                    </div>

                    <div class="form-row">
                      <app-input
                        label="Hospital Affiliations"
                        formControlName="hospitalAffiliations"
                        placeholder="Enter hospital affiliations"
                        [disabled]="!isEditing"
                        class="form-field">
                      </app-input>
                    </div>

                    <div class="form-row">
                      <app-input
                        label="Clinic Affiliations"
                        formControlName="clinicAffiliations"
                        placeholder="Enter clinic affiliations"
                        [disabled]="!isEditing"
                        class="form-field">
                      </app-input>
                    </div>

                    <div class="form-row full-width">
                      <label class="form-label">Associated Departments</label>
                      <div class="chips-container">
                        <mat-chip-listbox formControlName="associatedDepartments" [disabled]="!isEditing">
                          <mat-chip-option *ngFor="let dept of profileForm.get('associatedDepartments')?.value" 
                                          [value]="dept" 
                                          (removed)="removeDepartment(dept)">
                            {{ dept }}
                            <mat-icon matChipRemove *ngIf="isEditing">cancel</mat-icon>
                          </mat-chip-option>
                        </mat-chip-listbox>
                        <app-selectbox
                          *ngIf="isEditing"
                          [options]="departments"
                          placeholder="Add department"
                          (dataChange)="addDepartment($event)"
                          class="add-chip-select">
                        </app-selectbox>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="form-section">
                  <div class="section-header">
                    <app-icon [fontIcon]="'schedule'" [size]="24" [color]="'#3b82f6'"></app-icon>
                    <h3 class="section-title">Availability & Schedule</h3>
                  </div>
                  <div class="form-grid">
                    <div class="form-row">
                      <app-selectbox
                        label="Working Hours"
                        formControlName="workingHours"
                        [options]="availabilityOptions"
                        [disabled]="!isEditing"
                        class="form-field">
                      </app-selectbox>
                    </div>

                    <div class="form-row">
                      <app-input
                        label="Available Days"
                        formControlName="availableDays"
                        placeholder="e.g., Monday to Friday"
                        [disabled]="!isEditing"
                        class="form-field">
                      </app-input>
                    </div>

                    <div class="form-row">
                      <app-input
                        label="Emergency Availability"
                        formControlName="emergencyAvailability"
                        placeholder="Describe emergency availability"
                        [disabled]="!isEditing"
                        class="form-field">
                      </app-input>
                    </div>
                  </div>
                </div>

                <div class="form-section">
                  <div class="section-header">
                    <app-icon [fontIcon]="'language'" [size]="24" [color]="'#3b82f6'"></app-icon>
                    <h3 class="section-title">Languages & Communication</h3>
                  </div>
                  <div class="form-grid">
                    <div class="form-row full-width">
                      <label class="form-label">Languages Spoken</label>
                      <div class="chips-container">
                        <mat-chip-listbox formControlName="languagesSpoken" [disabled]="!isEditing">
                          <mat-chip-option *ngFor="let lang of languages" [value]="lang">
                            {{ lang }}
                            <mat-icon matChipRemove *ngIf="isEditing">cancel</mat-icon>
                          </mat-chip-option>
                        </mat-chip-listbox>
                        <div class="add-chip-input" *ngIf="isEditing">
                          <app-selectbox
                            placeholder="Add language"
                            [options]="languages"
                            class="add-chip-select"
                            (dataChange)="addLanguage($event)">
                          </app-selectbox>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </form>
            </div>
          </mat-tab>

          <!-- Financial Tab -->
          <mat-tab>
            <ng-template mat-tab-label>
              <div class="tab-label">
                <app-icon [fontIcon]="'attach_money'" [size]="20" [color]="'currentColor'"></app-icon>
                <span>Financial</span>
              </div>
            </ng-template>
            <div class="tab-content">
              <div class="tab-description">
                <h3>Financial Information</h3>
                <p>Manage your consultation fees, payment methods, and insurance policies</p>
                <div class="financial-actions" style="margin: 16px 0 8px; display: flex; gap: 12px;">
                  <app-button
                    [text]="'Add / Manage Fees'"
                    [color]="'primary'"
                    [fontIcon]="'add'"
                    (btnClick)="openPricingDialog()"
                    style="flex: 0 0 auto;">
                  </app-button>
                  <app-button
                    [text]="'Add Pricing Item'"
                    [color]="'accent'"
                    [fontIcon]="'add'"
                    (btnClick)="addOrEditPricingItem()"
                    style="flex: 0 0 auto;">
                  </app-button>
                </div>
              </div>
              <form [formGroup]="profileForm" class="profile-form">
                <div class="form-section">
                  <div class="section-header">
                    <app-icon [fontIcon]="'attach_money'" [size]="24" [color]="'#3b82f6'"></app-icon>
                    <h3 class="section-title">Pricing Management</h3>
                  </div>

                  <!-- Pricing Items Grid -->
                  <app-grid
                    [rowData]="pricingItems"
                    [columnDefs]="pricingColumnDefs"
                    [gridOptions]="pricingGridOptions"
                    [height]="'auto'"
                    [showHeader]="true"
                    [searchPlaceholder]="'Search pricing items...'"
                    class="pricing-grid">
                  </app-grid>

                  <!-- Empty State -->
                  <div class="empty-state" *ngIf="pricingItems.length === 0">
                    <div class="empty-icon">ðŸ’°</div>
                    <div class="empty-title">No Pricing Items Yet</div>
                    <div class="empty-description">
                      Start by adding your first pricing item. You can set consultation fees,
                      follow-up pricing, and other treatment costs.
                    </div>
                  </div>
                </div>
              </form>
            </div>
          </mat-tab>

          <!-- Settings Tab -->
          <mat-tab>
            <ng-template mat-tab-label>
              <div class="tab-label">
                <app-icon [fontIcon]="'settings'" [size]="20" [color]="'currentColor'"></app-icon>
                <span>Settings</span>
              </div>
            </ng-template>
            <div class="tab-content">
              <div class="tab-description">
                <h3>Settings & Preferences</h3>
                <p>Manage your security settings, notification preferences, and calendar integrations</p>
              </div>
              <form [formGroup]="profileForm" class="profile-form">
                <div class="form-section">
                  <div class="section-header">
                    <app-icon [fontIcon]="'security'" [size]="24" [color]="'#3b82f6'"></app-icon>
                    <h3 class="section-title">Security Settings</h3>
                  </div>
                  <div class="form-grid">
                    <div class="form-row">
                      <app-input
                        label="Current Password"
                        formControlName="currentPassword"
                        placeholder="Enter current password"
                        type="password"
                        [disabled]="!isEditing"
                        class="form-field">
                      </app-input>
                    </div>

                    <div class="form-row">
                      <app-input
                        label="New Password"
                        formControlName="newPassword"
                        placeholder="Enter new password"
                        type="password"
                        [disabled]="!isEditing"
                        class="form-field">
                      </app-input>
                    </div>

                    <div class="form-row">
                      <app-input
                        label="Confirm New Password"
                        formControlName="confirmPassword"
                        placeholder="Confirm new password"
                        type="password"
                        [disabled]="!isEditing"
                        class="form-field">
                      </app-input>
                    </div>
                  </div>
                </div>

                <div class="form-section">
                  <div class="section-header">
                    <app-icon [fontIcon]="'notifications'" [size]="24" [color]="'#3b82f6'"></app-icon>
                    <h3 class="section-title">Notification Preferences</h3>
                  </div>
                  <div class="form-grid">
                    <div class="form-row full-width">
                      <label class="form-label">Notification Settings</label>
                      <div class="checkbox-group">
                        <mat-checkbox formControlName="emailNotifications" [disabled]="!isEditing">
                          Email Notifications
                        </mat-checkbox>
                        <mat-checkbox formControlName="smsNotifications" [disabled]="!isEditing">
                          SMS Notifications
                        </mat-checkbox>
                        <mat-checkbox formControlName="appNotifications" [disabled]="!isEditing">
                          App Notifications
                        </mat-checkbox>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="form-section">
                  <div class="section-header">
                    <app-icon [fontIcon]="'calendar_today'" [size]="24" [color]="'#3b82f6'"></app-icon>
                    <h3 class="section-title">Calendar Integration</h3>
                  </div>
                  <div class="form-grid">
                    <div class="form-row">
                      <app-selectbox
                        label="Default Calendar"
                        formControlName="defaultCalendar"
                        [options]="['Google Calendar', 'Outlook', 'Apple Calendar', 'Other']"
                        [disabled]="!isEditing"
                        class="form-field">
                      </app-selectbox>
                    </div>

                    <div class="form-row">
                      <app-input
                        label="Calendar Sync Interval"
                        formControlName="calendarSyncInterval"
                        placeholder="e.g., 15 minutes"
                        [disabled]="!isEditing"
                        class="form-field">
                      </app-input>
                    </div>
                  </div>
                </div>
              </form>
            </div>
          </mat-tab>
        </mat-tab-group>
      </div>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="form-actions" *ngIf="isEditing">
    <div class="action-buttons">
      <app-button
        type="button"
        [appearance]="'basic'"
        [color]="'accent'"
        [fontIcon]="'close'"
        (btnClick)="onCancel()"
        [text]="'Cancel'"
        class="cancel-btn">
      </app-button>

      <app-button
        type="button"
        [appearance]="'raised'"
        [color]="'primary'"
        [fontIcon]="'save'"
        (btnClick)="onSave()"
        [disabled]="profileForm.invalid"
        [text]="'Save Changes'"
        class="save-btn">
      </app-button>
    </div>
  </div>
</div>
