<!-- Professional Doctor Profile Component -->
<div class="doctor-profile-container">
  <!-- Profile Header -->
  <div class="profile-header">
    <div class="header-background">
      <div class="header-gradient"></div>
      <div class="header-pattern"></div>
    </div>
    
    <div class="profile-avatar-section">
      <div class="avatar-container">
        <div class="avatar">
          <img 
            [src]="doctorProfile.profileImageUrl || 'assets/avatars/default-avatar.jpg'" 
            alt="Doctor Profile"
            class="avatar-image"
            (error)="onImageError($event)">
          <div class="avatar-overlay" *ngIf="isEditing">
            <mat-icon>camera_alt</mat-icon>
            <span>Change Photo</span>
          </div>
        </div>
        <div class="status-badge" [class]="'status-' + doctorProfile.doctorStatus.toLowerCase()">
          <mat-icon>verified</mat-icon>
          <span>{{ doctorProfile.doctorStatus }}</span>
        </div>
      </div>
      
      <div class="profile-info">
        <h1 class="doctor-name">{{ doctorProfile.firstName }} {{ doctorProfile.lastName }}</h1>
        <p class="doctor-title">{{ doctorProfile.specialization }}</p>
        <div class="doctor-stats">
          <div class="stat-item">
            <mat-icon>schedule</mat-icon>
            <span>{{ doctorProfile.experienceYears }} years experience</span>
          </div>
          <div class="stat-item">
            <mat-icon>verified_user</mat-icon>
            <span>License: {{ doctorProfile.registrationNumber }}</span>
          </div>
          <div class="stat-item">
            <mat-icon>location_on</mat-icon>
            <span>{{ doctorProfile.primaryHospital }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Profile Content -->
  <div class="profile-content">
    <div class="profile-card">
      <!-- Action Bar -->
      <div class="action-bar">
        <div class="action-left">
          <h2 class="page-title">Doctor Profile</h2>
          <p class="page-subtitle">Manage your professional information and credentials</p>
        </div>
        <div class="action-right">
          <button 
            *ngIf="!isEditing"
            mat-raised-button 
            color="primary"
            (click)="startEditing()"
            class="edit-btn">
            <mat-icon>edit</mat-icon>
            Edit Profile
          </button>
          <div *ngIf="isEditing" class="edit-actions">
            <button 
              mat-button 
              (click)="cancelEditing()"
              class="cancel-btn">
              Cancel
            </button>
            <button 
              mat-raised-button 
              color="primary"
              (click)="saveProfile()"
              [disabled]="profileForm.invalid || isSaving"
              class="save-btn">
              <mat-spinner *ngIf="isSaving" diameter="16"></mat-spinner>
              <mat-icon *ngIf="!isSaving">save</mat-icon>
              {{ isSaving ? 'Saving...' : 'Save Changes' }}
            </button>
          </div>
        </div>
      </div>

      <!-- Profile Sections -->
      <form [formGroup]="profileForm" class="profile-sections">
        
        <!-- Basic Information Section -->
        <div class="profile-section">
          <div class="section-header">
            <div class="section-icon">
              <mat-icon>person_outline</mat-icon>
            </div>
            <div class="section-title">
              <h3>Basic Information</h3>
              <p>Personal details and identification information</p>
            </div>
            <div class="section-badge">
              <span class="badge read-only">Read Only</span>
            </div>
          </div>
          
          <div class="section-content">
            <div class="info-grid">
              <div class="info-item">
                <label class="info-label">First Name</label>
                <div class="info-value">{{ doctorProfile.firstName }}</div>
              </div>
              
              <div class="info-item">
                <label class="info-label">Last Name</label>
                <div class="info-value">{{ doctorProfile.lastName }}</div>
              </div>
              
              <div class="info-item">
                <label class="info-label">Registration Number / License</label>
                <div class="info-value license-number">{{ doctorProfile.registrationNumber }}</div>
              </div>
              
              <div class="info-item">
                <label class="info-label">Date of Birth</label>
                <div class="info-value">{{ doctorProfile.dateOfBirth | date:'mediumDate' }}</div>
              </div>
              
              <div class="info-item">
                <label class="info-label">Gender</label>
                <div class="info-value">{{ doctorProfile.gender }}</div>
              </div>
              
              <div class="info-item">
                <label class="info-label">Email Address</label>
                <div class="info-value">
                  <span *ngIf="!isEditing">{{ doctorProfile.email }}</span>
                  <input 
                    *ngIf="isEditing"
                    type="email"
                    formControlName="email"
                    class="editable-input"
                    placeholder="Enter email address">
                </div>
              </div>
              
              <div class="info-item">
                <label class="info-label">Contact Number</label>
                <div class="info-value">
                  <span *ngIf="!isEditing">{{ doctorProfile.contactNumber }}</span>
                  <input 
                    *ngIf="isEditing"
                    type="tel"
                    formControlName="contactNumber"
                    class="editable-input"
                    placeholder="Enter contact number">
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Address Information Section -->
        <div class="profile-section">
          <div class="section-header">
            <div class="section-icon">
              <mat-icon>location_on</mat-icon>
            </div>
            <div class="section-title">
              <h3>Address Information</h3>
              <p>Connected hospital working addresses</p>
            </div>
            <div class="section-badge">
              <span class="badge read-only">Read Only</span>
            </div>
          </div>
          
          <div class="section-content">
            <div class="hospital-addresses">
              <div class="address-card" *ngFor="let address of doctorProfile.hospitalAddresses; let i = index">
                <div class="address-header">
                  <mat-icon>business</mat-icon>
                  <h4>{{ address.hospitalName }}</h4>
                  <span class="address-type">{{ address.type }}</span>
                </div>
                <div class="address-details">
                  <p class="address-line">{{ address.streetAddress }}</p>
                  <p class="address-line">{{ address.city }}, {{ address.state }} {{ address.postalCode }}</p>
                  <p class="address-line">{{ address.country }}</p>
                  <div class="address-contact">
                    <span><mat-icon>phone</mat-icon> {{ address.phone }}</span>
                    <span><mat-icon>email</mat-icon> {{ address.email }}</span>
                  </div>
                </div>
              </div>
              
              <div class="empty-addresses" *ngIf="doctorProfile.hospitalAddresses?.length === 0">
                <mat-icon>location_off</mat-icon>
                <p>No hospital addresses found</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Professional Bio Section -->
        <div class="profile-section">
          <div class="section-header">
            <div class="section-icon">
              <mat-icon>description</mat-icon>
            </div>
            <div class="section-title">
              <h3>Professional Bio</h3>
              <p>Your professional background and approach to patient care</p>
            </div>
            <div class="section-badge">
              <span class="badge editable">Editable</span>
            </div>
          </div>
          
          <div class="section-content">
            <div class="bio-content">
              <div *ngIf="!isEditing" class="bio-text">
                <p>{{ doctorProfile.professionalBio || 'No professional bio available. Click edit to add your bio.' }}</p>
                <!-- Debug info -->
                <small style="color: #666; display: block; margin-top: 8px;">
                  Debug: Bio length = {{ (doctorProfile.professionalBio || '').length }}, 
                  Bio value = "{{ doctorProfile.professionalBio }}"
                </small>
              </div>
              <div *ngIf="isEditing" class="bio-edit">
                <textarea 
                  formControlName="professionalBio"
                  class="bio-textarea"
                  placeholder="Tell us about your professional background, expertise, and approach to patient care..."
                  rows="6"></textarea>
                <div class="bio-counter">
                  <span>{{ (profileForm.get('professionalBio')?.value || '').length }}/1000 characters</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Medical Credentials Section -->
        <div class="profile-section">
          <div class="section-header">
            <div class="section-icon">
              <mat-icon>medical_services</mat-icon>
            </div>
            <div class="section-title">
              <h3>Medical Credentials</h3>
              <p>Your qualifications, specializations, and experience</p>
            </div>
            <div class="section-badge">
              <span class="badge" [class.read-only]="!isEditing" [class.editable]="isEditing">
                {{ isEditing ? 'Editing' : 'Read Only' }}
              </span>
            </div>
          </div>
          
          <div class="section-content">
            <div class="credentials-grid">
              <!-- Primary Specialization -->
              <div class="credential-item">
                <label class="credential-label">Primary Specialization *</label>
                <div class="credential-value" *ngIf="!isEditing">
                  {{ doctorProfile.specialization }}
                </div>
                <div class="credential-input" *ngIf="isEditing">
                  <input 
                    type="text" 
                    [formControlName]="'specialization'"
                    placeholder="Enter primary specialization"
                    class="form-input"
                    [class.error]="profileForm.get('specialization')?.invalid && profileForm.get('specialization')?.touched"
                  >
                  <div class="error-message" *ngIf="profileForm.get('specialization')?.invalid && profileForm.get('specialization')?.touched">
                    {{ getErrorMessage('specialization') }}
                  </div>
                </div>
              </div>
              
              <!-- Additional Specializations -->
              <div class="credential-item">
                <label class="credential-label">Additional Specializations</label>
                <div class="credential-value" *ngIf="!isEditing">
                  <div class="specialization-tags">
                    <span class="tag" *ngFor="let spec of doctorProfile.additionalSpecializations || []">
                      {{ spec }}
                    </span>
                  </div>
                </div>
                <div class="credential-input" *ngIf="isEditing">
                  <div class="tags-container">
                    <span class="tag editable-tag" *ngFor="let spec of profileForm.get('additionalSpecializations')?.value; let i = index">
                      {{ spec }}
                      <button type="button" class="remove-tag" (click)="removeArrayItem('additionalSpecializations', i)">
                        <mat-icon>close</mat-icon>
                      </button>
                    </span>
                  </div>
                  <div class="add-item-input">
                    <input 
                      type="text" 
                      id="newSpecialization"
                      placeholder="Add specialization"
                      class="form-input"
                    >
                    <button type="button" class="add-btn" (click)="addSpecialization()">
                      <mat-icon>add</mat-icon>
                    </button>
                  </div>
                </div>
              </div>
              
              <!-- Qualifications -->
              <div class="credential-item">
                <label class="credential-label">Qualifications</label>
                <div class="credential-value" *ngIf="!isEditing">
                  <div class="qualification-list">
                    <div class="qualification-item" *ngFor="let qual of doctorProfile.qualifications || []">
                      <mat-icon>school</mat-icon>
                      <span>{{ qual }}</span>
                    </div>
                  </div>
                </div>
                <div class="credential-input" *ngIf="isEditing">
                  <div class="tags-container">
                    <span class="tag editable-tag" *ngFor="let qual of profileForm.get('qualifications')?.value; let i = index">
                      {{ qual }}
                      <button type="button" class="remove-tag" (click)="removeArrayItem('qualifications', i)">
                        <mat-icon>close</mat-icon>
                      </button>
                    </span>
                  </div>
                  <div class="add-item-input">
                    <input 
                      type="text" 
                      id="newQualification"
                      placeholder="Add qualification"
                      class="form-input"
                    >
                    <button type="button" class="add-btn" (click)="addQualification()">
                      <mat-icon>add</mat-icon>
                    </button>
                  </div>
                </div>
              </div>
              
              <!-- Work Start Date -->
              <div class="credential-item">
                <label class="credential-label">Work Start Date *</label>
                <div class="credential-value" *ngIf="!isEditing">
                  {{ doctorProfile.workStartDate | date:'mediumDate' }}
                </div>
                <div class="credential-input" *ngIf="isEditing">
                  <input 
                    type="date" 
                    [formControlName]="'workStartDate'"
                    class="form-input"
                    [class.error]="profileForm.get('workStartDate')?.invalid && profileForm.get('workStartDate')?.touched"
                  >
                  <div class="error-message" *ngIf="profileForm.get('workStartDate')?.invalid && profileForm.get('workStartDate')?.touched">
                    {{ getErrorMessage('workStartDate') }}
                  </div>
                </div>
              </div>
              
              <!-- Years of Experience -->
              <div class="credential-item">
                <label class="credential-label">Years of Experience *</label>
                <div class="credential-value experience-badge" *ngIf="!isEditing">
                  <span>{{ doctorProfile.experienceYears }} years</span>
                </div>
                <div class="credential-input" *ngIf="isEditing">
                  <input 
                    type="number" 
                    [formControlName]="'experienceYears'"
                    placeholder="Enter years of experience"
                    class="form-input"
                    min="0"
                    max="50"
                    [class.error]="profileForm.get('experienceYears')?.invalid && profileForm.get('experienceYears')?.touched"
                  >
                  <div class="error-message" *ngIf="profileForm.get('experienceYears')?.invalid && profileForm.get('experienceYears')?.touched">
                    {{ getErrorMessage('experienceYears') }}
                  </div>
                </div>
              </div>
              
              <!-- Certifications -->
              <div class="credential-item">
                <label class="credential-label">Certifications</label>
                <div class="credential-value" *ngIf="!isEditing">
                  <div class="certification-tags">
                    <span class="tag" *ngFor="let cert of doctorProfile.certifications || []">
                      {{ cert }}
                    </span>
                  </div>
                </div>
                <div class="credential-input" *ngIf="isEditing">
                  <div class="tags-container">
                    <span class="tag editable-tag" *ngFor="let cert of profileForm.get('certifications')?.value; let i = index">
                      {{ cert }}
                      <button type="button" class="remove-tag" (click)="removeArrayItem('certifications', i)">
                        <mat-icon>close</mat-icon>
                      </button>
                    </span>
                  </div>
                  <div class="add-item-input">
                    <input 
                      type="text" 
                      id="newCertification"
                      placeholder="Add certification"
                      class="form-input"
                    >
                    <button type="button" class="add-btn" (click)="addCertification()">
                      <mat-icon>add</mat-icon>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Affiliations Section -->
        <div class="profile-section">
          <div class="section-header">
            <div class="section-icon">
              <mat-icon>business</mat-icon>
            </div>
            <div class="section-title">
              <h3>Affiliations</h3>
              <p>Hospital and institutional affiliations</p>
            </div>
            <div class="section-badge">
              <span class="badge read-only">Read Only</span>
            </div>
          </div>
          
          <div class="section-content">
            <div class="affiliations-grid">
              <div class="affiliation-card" *ngFor="let affiliation of doctorProfile.affiliations || []">
                <div class="affiliation-header">
                  <mat-icon>business</mat-icon>
                  <h4>{{ affiliation.institutionName }}</h4>
                  <span class="affiliation-type">{{ affiliation.type }}</span>
                </div>
                <div class="affiliation-details">
                  <p class="affiliation-role">{{ affiliation.role }}</p>
                  <p class="affiliation-period">{{ affiliation.startDate | date:'MMM yyyy' }} - {{ affiliation.endDate ? (affiliation.endDate | date:'MMM yyyy') : 'Present' }}</p>
                  <div class="affiliation-description">
                    <p>{{ affiliation.description }}</p>
                  </div>
                </div>
              </div>
              
              <div class="empty-affiliations" *ngIf="doctorProfile.affiliations?.length === 0">
                <mat-icon>business_center</mat-icon>
                <p>No affiliations found</p>
              </div>
            </div>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
