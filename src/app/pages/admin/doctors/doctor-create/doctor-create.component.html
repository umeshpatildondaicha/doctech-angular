<div class="doctor-create-dialog">
  <div class="dialog-header">
    <h2>
      <mat-icon>person_add</mat-icon>
      Create New Doctor
    </h2>
    <button mat-icon-button (click)="onCancel()" class="close-button">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <!-- Warning Message -->
  <div class="warning-message">
    <mat-icon>warning</mat-icon>
    <div class="warning-content">
      <strong>Important:</strong> Please add doctor information properly. Verify all details before submission. 
      Whatever happens with the doctor will be your responsibility, not the platform's mistake.
    </div>
  </div>

  <!-- Backend Connection Status -->
  <div class="connection-status" [class.connected]="backendConnected" [class.disconnected]="!backendConnected">
    <mat-icon>{{ backendConnected ? 'wifi' : 'wifi_off' }}</mat-icon>
    <span>{{ backendConnected ? 'Backend Connected' : 'Backend Disconnected' }}</span>
    <button mat-button 
            (click)="testBackendConnection()" 
            class="test-connection-btn"
            [disabled]="isLoading">
      <mat-icon>refresh</mat-icon>
      Test Connection
    </button>
  </div>

  <!-- Tab Navigation -->
  <div class="tab-navigation">
    <mat-tab-group [(selectedIndex)]="selectedTabIndex" (selectedIndexChange)="onTabChange($event)">
      
      <!-- Invite Existing Doctor Tab -->
      <mat-tab label="Invite Existing Doctor">
        <div class="tab-content">
          <div class="section-header">
            <h3>
              <mat-icon>person_add_alt</mat-icon>
              Invite Existing Doctor
            </h3>
            <p class="section-description">
              Invite an existing doctor to join your hospital by their mobile number
            </p>
          </div>
          
          <div class="invite-form">
            <div class="form-row">
              <div class="form-field">
                <mat-form-field appearance="outline" class="full-width">
                  <mat-label>Mobile Number *</mat-label>
                  <input matInput 
                         [(ngModel)]="inviteMobileNumber" 
                         placeholder="+91 98765 43210"
                         [class.invalid]="inviteMobileNumberError"
                         (input)="clearInviteError()">
                  <mat-error *ngIf="inviteMobileNumberError">
                    {{ inviteMobileNumberError }}
                  </mat-error>
                  <mat-hint>Enter the doctor's registered mobile number</mat-hint>
                </mat-form-field>
              </div>
              
              <div class="form-field">
                <mat-form-field appearance="outline" class="full-width">
                  <mat-label>Hospital Role</mat-label>
                  <mat-select [(ngModel)]="inviteRole">
                    <mat-option value="DOCTOR">Doctor</mat-option>
                    <mat-option value="SENIOR_DOCTOR">Senior Doctor</mat-option>
                    <mat-option value="CONSULTANT">Consultant</mat-option>
                    <mat-option value="SPECIALIST">Specialist</mat-option>
                  </mat-select>
                  <mat-hint>Select the role for this doctor</mat-hint>
                </mat-form-field>
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-field">
                <mat-form-field appearance="outline" class="full-width">
                  <mat-label>Invitation Message</mat-label>
                  <textarea matInput 
                            [(ngModel)]="inviteMessage" 
                            placeholder="Personal invitation message (optional)"
                            rows="3"></textarea>
                  <mat-hint>Optional personal message for the doctor</mat-hint>
                </mat-form-field>
              </div>
            </div>
            
            <div class="invite-actions">
              <button type="button" 
                      mat-raised-button 
                      color="accent" 
                      (click)="inviteExistingDoctor()"
                                              [disabled]="!inviteMobileNumber.trim() || isInviting">
                <mat-icon *ngIf="!isInviting">send</mat-icon>
                <mat-spinner *ngIf="isInviting" diameter="20"></mat-spinner>
                {{ isInviting ? 'Sending Invitation...' : 'Send Invitation' }}
              </button>
            </div>
          </div>
        </div>
      </mat-tab>
      
      <!-- Add New Doctor Tab -->
      <mat-tab label="Add New Doctor">
        <div class="tab-content">
          <div class="section-header">
            <h3>
              <mat-icon>person_add</mat-icon>
              Create New Doctor
            </h3>
            <p class="section-description">
              Add a completely new doctor to the system
            </p>
          </div>
          
          <form [formGroup]="doctorForm" (ngSubmit)="onSubmit()" class="doctor-form">
            <div class="form-content">
      
      <!-- Mandatory Fields Section -->
      <div class="form-section">
        <h3 class="section-title">
          <mat-icon>star</mat-icon>
          Required Information
        </h3>
        
        <div class="form-row">
          <div class="form-field">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Registration Number *</mat-label>
              <input matInput 
                     formControlName="registrationNumber" 
                     placeholder="DOC-12345"
                     [class.invalid]="isFieldInvalid('registrationNumber')">
              <mat-error *ngIf="getErrorMessage('registrationNumber')">
                {{ getErrorMessage('registrationNumber') }}
              </mat-error>
              <mat-hint>Format: DOC-12345</mat-hint>
            </mat-form-field>
          </div>
          
          <div class="form-field">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>First Name *</mat-label>
              <input matInput 
                     formControlName="firstName" 
                     placeholder="Enter first name"
                     [class.invalid]="isFieldInvalid('firstName')">
              <mat-error *ngIf="getErrorMessage('firstName')">
                {{ getErrorMessage('firstName') }}
              </mat-error>
            </mat-form-field>
          </div>
        </div>

        <div class="form-row">
          <div class="form-field">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Last Name *</mat-label>
              <input matInput 
                     formControlName="lastName" 
                     placeholder="Enter last name"
                     [class.invalid]="isFieldInvalid('lastName')">
              <mat-error *ngIf="getErrorMessage('lastName')">
                {{ getErrorMessage('lastName') }}
              </mat-error>
            </mat-form-field>
          </div>
          
          <div class="form-field">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Specialization *</mat-label>
              <mat-select formControlName="specialization" 
                          [class.invalid]="isFieldInvalid('specialization')">
                <mat-option *ngFor="let spec of specializations" [value]="spec">
                  {{ spec }}
                </mat-option>
              </mat-select>
              <mat-error *ngIf="getErrorMessage('specialization')">
                {{ getErrorMessage('specialization') }}
              </mat-error>
            </mat-form-field>
          </div>
        </div>

        <div class="form-row">
          <div class="form-field">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Password *</mat-label>
              <input matInput 
                     type="password" 
                     formControlName="password" 
                     placeholder="Enter password"
                     [class.invalid]="isFieldInvalid('password')">
              <mat-error *ngIf="getErrorMessage('password')">
                {{ getErrorMessage('password') }}
              </mat-error>
              <mat-hint>Min 8 chars, must include uppercase, lowercase, number & special char</mat-hint>
            </mat-form-field>
          </div>
          
          <div class="form-field">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Doctor Status *</mat-label>
              <mat-select formControlName="doctorStatus" 
                          [class.invalid]="isFieldInvalid('doctorStatus')">
                <mat-option *ngFor="let status of doctorStatusOptions" [value]="status.value">
                  {{ status.label }}
                </mat-option>
              </mat-select>
              <mat-error *ngIf="getErrorMessage('doctorStatus')">
                {{ getErrorMessage('doctorStatus') }}
              </mat-error>
            </mat-form-field>
          </div>
        </div>
      </div>

      <!-- Optional Fields Section -->
      <div class="form-section">
        <h3 class="section-title">
          <mat-icon>info</mat-icon>
          Additional Information
        </h3>
        
        <div class="form-row">
          <div class="form-field">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Contact Number</mat-label>
              <input matInput 
                     formControlName="contactNumber" 
                     placeholder="+91 98765 43210"
                     [class.invalid]="isFieldInvalid('contactNumber')">
              <mat-error *ngIf="getErrorMessage('contactNumber')">
                {{ getErrorMessage('contactNumber') }}
              </mat-error>
            </mat-form-field>
          </div>
          
          <div class="form-field">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Email</mat-label>
              <input matInput 
                     type="email" 
                     formControlName="email" 
                     placeholder="doctor@example.com"
                     [class.invalid]="isFieldInvalid('email')">
              <mat-error *ngIf="getErrorMessage('email')">
                {{ getErrorMessage('email') }}
              </mat-error>
            </mat-form-field>
          </div>
        </div>

        <div class="form-row">
          <div class="form-field">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Qualifications</mat-label>
              <input matInput 
                     formControlName="qualifications" 
                     placeholder="MBBS, MD, etc."
                     [class.invalid]="isFieldInvalid('qualifications')">
              <mat-error *ngIf="getErrorMessage('qualifications')">
                {{ getErrorMessage('qualifications') }}
              </mat-error>
            </mat-form-field>
          </div>
        </div>

        <!-- Certifications Section -->
        <div class="form-field">
          <label class="field-label">Available Certifications</label>
          <div class="certifications-container">
            
            <!-- Custom Certification Input -->
            <div class="custom-certification">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Add Custom Certification</mat-label>
                <input matInput 
                       [(ngModel)]="customCertification" 
                       placeholder="Enter custom certification name"
                       (keyup.enter)="addCustomCertification()">
                <mat-hint>Press Enter to add custom certification</mat-hint>
                <button mat-icon-button matSuffix (click)="addCustomCertification()" 
                        [disabled]="!customCertification.trim()">
                  <mat-icon>add_circle</mat-icon>
                </button>
              </mat-form-field>
            </div>

            <div class="available-certifications">
              <p class="cert-hint">Click on certifications to select/deselect them:</p>
              <div class="cert-chips">
                <mat-chip 
                  *ngFor="let cert of certificationOptions" 
                  [class.selected]="doctorForm.get('certifications')?.value?.includes(cert)"
                  (click)="toggleCertification(cert)"
                  class="cert-chip">
                  {{ cert }}
                </mat-chip>
              </div>
            </div>
            
            <div class="selected-certifications" *ngIf="doctorForm.get('certifications')?.value?.length > 0">
              <h4>Selected Certifications ({{ doctorForm.get('certifications')?.value?.length }}):</h4>
              <div class="cert-chips">
                <mat-chip 
                  *ngFor="let cert of doctorForm.get('certifications')?.value" 
                  (removed)="removeCertification(cert)"
                  class="selected-cert-chip">
                  {{ cert }}
                  <mat-icon matChipRemove>cancel</mat-icon>
                </mat-chip>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Form Actions -->
      <div class="form-actions">
        <button type="button" 
                mat-button 
                (click)="onCancel()" 
                class="cancel-button">
          Cancel
        </button>
        <button type="submit" 
                mat-raised-button 
                color="primary" 
                [disabled]="doctorForm.invalid || isLoading"
                class="submit-button">
          <mat-icon *ngIf="!isLoading">save</mat-icon>
          <mat-spinner *ngIf="isLoading" diameter="20"></mat-spinner>
          {{ isLoading ? 'Creating...' : 'Create Doctor' }}
        </button>
      </div>
    </form>
  </div>
</mat-tab>
</mat-tab-group>
</div>
