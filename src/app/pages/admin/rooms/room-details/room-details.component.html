<div class="room-details-page" *ngIf="!loading">
  <!-- Header -->
  <div class="page-header">
    <div class="header-left">
      <app-button 
        [text]="'Back'" 
        [color]="'accent'" 
        [fontIcon]="'arrow_back'"
        (btnClick)="back()">
      </app-button>
      <div class="breadcrumb">
        <span class="breadcrumb-item">Admin</span>
        <span class="breadcrumb-separator">•</span>
        <span class="breadcrumb-item">Rooms & Beds</span>
        <span class="breadcrumb-separator">•</span>
        <span class="breadcrumb-item current">{{ room?.number }}</span>
      </div>
    </div>
    <div class="header-actions">
      <app-button 
        [text]="'Edit Room'" 
        [color]="'primary'" 
        [fontIcon]="'edit'"
        (btnClick)="onEditRoom()">
      </app-button>
    </div>
  </div>

  <!-- Room Info -->
  <div class="room-info-card" *ngIf="room">
    <div class="card-header">
      <div class="room-title">
        <h1>{{ room.number }}</h1>
        <div class="room-type">{{ room.type }}</div>
      </div>
      <div class="room-status" [style.color]="getRoomStatusColor(room.status)">
        {{ room.status }}
      </div>
    </div>
    
    <div class="room-details-grid">
      <div class="detail-item">
        <span class="label">Floor:</span>
        <span class="value">{{ room.floor }}</span>
      </div>
      <div class="detail-item">
        <span class="label">Wing:</span>
        <span class="value">{{ room.wing }}</span>
      </div>
      <div class="detail-item">
        <span class="label">Capacity:</span>
        <span class="value">{{ room.capacity }} beds</span>
      </div>
      <div class="detail-item">
        <span class="label">Occupied:</span>
        <span class="value">{{ room.occupied }} beds</span>
      </div>
      <div class="detail-item" *ngIf="room.icuLevel">
        <span class="label">ICU Level:</span>
        <span class="value">{{ room.icuLevel }}</span>
      </div>
      <div class="detail-item" *ngIf="room.facilities">
        <span class="label">Facilities:</span>
        <div class="facilities">
          <app-icon 
            *ngFor="let icon of facilityIcons(room.facilities)" 
            [fontIcon]="icon" 
            [size]="16"
            class="facility-icon">
          </app-icon>
        </div>
      </div>
    </div>
  </div>

  <!-- Beds Grid -->
  <div class="beds-section" *ngIf="room">
    <div class="section-header">
      <h2>{{ room.type }} - {{ room.number }}</h2>
      <div class="bed-summary">
        (Total Beds: {{ room.capacity }} | Available Beds: {{ room.capacity - room.occupied }})
      </div>
    </div>
    
    <div class="beds-grid-simple">
      <div 
        *ngFor="let bed of room.beds" 
        class="bed-item"
        [style.border-color]="getBedStatusColor(bed.status)"
        (click)="onBedClick(bed)">
        
        <div class="bed-icon">
          <app-icon [fontIcon]="'hotel'" [size]="24"></app-icon>
        </div>
        <div class="bed-id">{{ bed.id.split('-').pop() }}</div>
        <div class="bed-type" *ngIf="bed.status === 'Occupied'">{{ (bed.patientInfo?.name || 'Patient').split(' ')[0] }}</div>
        <div class="bed-type" *ngIf="bed.status !== 'Occupied'">{{ getBedTypeLabel(bed.status) }}</div>
      </div>
    </div>
  </div>

  <!-- Patient Details Overlay -->
  <div class="patient-details-overlay" *ngIf="showPatientDetails && selectedBed" (click)="closePatientDetails()">
    <div class="patient-details-panel" (click)="$event.stopPropagation()">
      <div class="panel-header">
        <h3>Patient Details</h3>
        <button class="close-btn" (click)="closePatientDetails()">
          <app-icon [fontIcon]="'close'" [size]="20"></app-icon>
        </button>
      </div>
      
      <div class="panel-content" *ngIf="selectedBed.patientInfo">
        <div class="patient-info-row">
          <span class="label">Patient ID:</span>
          <span class="value">{{ selectedBed.patientInfo.name.replace(' ', '').toUpperCase() }}{{ selectedBed.patientInfo.age }}</span>
        </div>
        <div class="patient-info-row">
          <span class="label">Patient Name:</span>
          <span class="value">{{ selectedBed.patientInfo.name }}</span>
        </div>
        <div class="patient-info-row">
          <span class="label">Age:</span>
          <span class="value">{{ selectedBed.patientInfo.age }}</span>
        </div>
        <div class="patient-info-row">
          <span class="label">Gender:</span>
          <span class="value">{{ selectedBed.patientInfo.gender === 'M' ? 'Male' : 'Female' }}</span>
        </div>
        <div class="patient-info-row">
          <span class="label">Department:</span>
          <span class="value">{{ room?.type }}</span>
        </div>
        <div class="patient-info-row">
          <span class="label">Location:</span>
          <span class="value">{{ room?.type }} Room {{ (room?.number || '').split('-')[1] || '' }}</span>
        </div>
        <div class="patient-info-row">
          <span class="label">Room / Bed#:</span>
          <span class="value">{{ selectedBed.id }}</span>
        </div>
        <div class="patient-info-row">
          <span class="label">Status:</span>
          <span class="value status-occupied">Occupied</span>
        </div>
        <div class="patient-info-row">
          <span class="label">Tags:</span>
          <span class="value">{{ selectedBed.patientInfo.diagnosis }}</span>
        </div>
      </div>
      
      <div class="panel-actions">
        <app-button [text]="'Admit'" [color]="'primary'" [class]="'action-btn'"></app-button>
        <app-button [text]="'Transfer'" [color]="'accent'" [class]="'action-btn'"></app-button>
        <app-button [text]="'Discharge'" [color]="'warn'" [class]="'action-btn'"></app-button>
      </div>
    </div>
  </div>
</div>

<!-- Loading State -->
<div class="loading-state" *ngIf="loading">
  <div class="loading-spinner">Loading room details...</div>
</div>
