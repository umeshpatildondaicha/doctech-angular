<div class="exercise-assignment-dialog">
  <div class="dialog-header">
    <h2 mat-dialog-title>Assign Exercises to {{ data.patientName }}</h2>
    <button mat-icon-button (click)="onCancel()" class="close-btn">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <div mat-dialog-content class="dialog-content">
    <div class="dialog-body">
      <!-- Left Section: Exercise Selection -->
      <div class="exercise-selection-section">
        <div class="selection-controls">
          <div class="browse-toolbar">
            <h3>Browse Exercises</h3>
          </div>

          <div class="search-inline">
            <mat-form-field appearance="outline" class="search-field small">
              <mat-label>Search</mat-label>
              <input matInput [(ngModel)]="searchQuery" [placeholder]="viewTab === 'exercises' ? 'Search exercises...' : 'Search exercise groups...'">
              <mat-icon matPrefix>search</mat-icon>
              <button mat-icon-button matSuffix (click)="searchQuery=''" *ngIf="searchQuery">
                <mat-icon>close</mat-icon>
              </button>
            </mat-form-field>
          </div>

          <div class="browse-tabs" role="tablist" aria-label="Exercise selection tabs">
            <button type="button" class="tab-btn" [class.active]="viewTab === 'exercises'" (click)="viewTab = 'exercises'" role="tab" [attr.aria-selected]="viewTab === 'exercises'">
              <mat-icon>fitness_center</mat-icon>
              <span class="tab-label">Exercises</span>
              <span class="tab-count" *ngIf="getFilteredExercises()?.length">{{ getFilteredExercises().length }}</span>
            </button>
            <button type="button" class="tab-btn" [class.active]="viewTab === 'groups'" (click)="viewTab = 'groups'" role="tab" [attr.aria-selected]="viewTab === 'groups'">
              <mat-icon>group_work</mat-icon>
              <span class="tab-label">Exercise Groups</span>
              <span class="tab-count" *ngIf="getFilteredGroups()?.length">{{ getFilteredGroups().length }}</span>
            </button>
          </div>
        </div>

        <!-- Exercises Tab -->
        <ng-container *ngIf="viewTab === 'exercises'">
          <div class="exercises-list">
            <div 
              *ngFor="let exercise of getFilteredExercises()" 
              class="exercise-item"
              [class.selected]="isExerciseSelected(exercise)"
              (click)="toggleExerciseSelection(exercise)"
              (keydown.enter)="toggleExerciseSelection(exercise)"
              tabindex="0"
              role="button"
              [attr.aria-label]="'Select ' + exercise.name">
              <div class="exercise-item-info">
                <h4 class="exercise-item-name">{{ exercise.name }}</h4>
                <p class="exercise-item-meta">{{ exercise.category }} • {{ exercise.difficulty }} • {{ getSetsDisplay(exercise) }}</p>
              </div>
              <div class="exercise-item-actions">
                <button 
                  mat-icon-button 
                  class="view-btn"
                  (click)="viewExercise(exercise, $event)"
                  matTooltip="View exercise details">
                  <mat-icon>visibility</mat-icon>
                </button>
                <mat-icon 
                  *ngIf="isExerciseSelected(exercise)" 
                  class="check-icon">
                  check_circle
                </mat-icon>
                <button 
                  *ngIf="!isExerciseSelected(exercise)"
                  mat-icon-button 
                  class="add-btn"
                  (click)="toggleExerciseSelection(exercise); $event.stopPropagation()"
                  matTooltip="Add exercise">
                  <mat-icon>add</mat-icon>
                </button>
              </div>
            </div>
          </div>
        </ng-container>

        <!-- Exercise Groups Tab -->
        <ng-container *ngIf="viewTab === 'groups'">
          <div class="exercise-groups-list">
            <div 
              *ngFor="let group of getFilteredGroups()" 
              class="exercise-group-item"
              [class.selected]="isGroupSelected(group)"
              (click)="selectGroup(group)"
              (keydown.enter)="selectGroup(group)"
              tabindex="0"
              role="button"
              [attr.aria-label]="'Select ' + group.groupName">
              <div class="group-info">
                <h4 class="group-name">{{ group.groupName }}</h4>
                <p class="group-meta">{{ group.exercises.length }} exercises • {{ group.category || 'N/A' }} • {{ group.difficulty || 'N/A' }}</p>
              </div>
              <div class="group-actions">
                <button 
                  mat-icon-button 
                  class="view-btn"
                  (click)="viewGroup(group, $event)"
                  matTooltip="View group details">
                  <mat-icon>visibility</mat-icon>
                </button>
                <mat-icon 
                  *ngIf="isGroupSelected(group)" 
                  class="check-icon">
                  check_circle
                </mat-icon>
                <button 
                  *ngIf="!isGroupSelected(group)"
                  mat-icon-button 
                  class="add-btn"
                  (click)="addGroup(group, $event)"
                  matTooltip="Add group">
                  <mat-icon>add</mat-icon>
                </button>
              </div>
            </div>
          </div>
        </ng-container>
      </div>

      <!-- Right Section: Assignment Summary -->
      <div class="assignment-summary-section">
        <h3>Assignment Summary ({{ getSelectedExercisesCount() }})</h3>
        
        <div *ngIf="selectedExercises.length > 0" class="summary-content">
          <!-- Selected Exercises List -->
          <div class="selected-exercises-list">
            <div 
              *ngFor="let exercise of selectedExercises; let i = index" 
              class="selected-exercise-item">
              <div class="exercise-info">
                <h5 class="exercise-name">{{ exercise.name }}</h5>
                <p class="exercise-meta">{{ exercise.category }} • {{ exercise.difficulty }}</p>
                <div class="sets-info-display">
                  <span class="sets-badge" [class.no-sets]="!exercise.sets || exercise.sets.length === 0">
                    <mat-icon class="sets-icon">repeat</mat-icon>
                    <span class="sets-text">{{ getSetsDisplay(exercise) }}</span>
                  </span>
                  <button 
                    mat-icon-button 
                    class="edit-sets-btn"
                    (click)="editExerciseSets(exercise, i)"
                    matTooltip="Edit Sets">
                    <mat-icon>edit</mat-icon>
                  </button>
                </div>
              </div>
              <button 
                mat-icon-button 
                (click)="removeExercise(i)"
                class="remove-btn">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          </div>
        </div>

        <!-- Empty State -->
        <div *ngIf="selectedExercises.length === 0" class="empty-state">
          <mat-icon class="empty-icon">fitness_center</mat-icon>
          <p>No exercises selected. Choose exercises from the list to add them.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div mat-dialog-actions class="dialog-footer">
    <div class="footer-left">
      <div class="date-fields">
        <mat-form-field appearance="outline" class="date-picker">
          <mat-label>Start Date</mat-label>
          <input 
            matInput 
            [matDatepicker]="pickerStart"
            [(ngModel)]="assignmentDate">
          <mat-datepicker-toggle matSuffix [for]="pickerStart"></mat-datepicker-toggle>
          <mat-datepicker #pickerStart></mat-datepicker>
        </mat-form-field>

        <mat-form-field appearance="outline" class="date-picker">
          <mat-label>Till Date</mat-label>
          <input 
            matInput 
            [matDatepicker]="pickerEnd"
            [(ngModel)]="endDate"
            [min]="assignmentDate">
          <mat-datepicker-toggle matSuffix [for]="pickerEnd"></mat-datepicker-toggle>
          <mat-datepicker #pickerEnd></mat-datepicker>
        </mat-form-field>
      </div>
    </div>
    <div class="footer-right">
      <button mat-stroked-button (click)="onCancel()" class="cancel-btn">
        Cancel
      </button>
      <button 
        mat-raised-button 
        color="primary" 
        (click)="onConfirm()" 
        [disabled]="selectedExercises.length === 0"
        class="confirm-btn">
        Assign Exercises
      </button>
    </div>
  </div>
</div>
